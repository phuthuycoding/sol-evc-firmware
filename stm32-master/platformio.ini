[env:stm32f103c8]
platform = ststm32
board = genericSTM32F103C8
framework = stm32cube

; Build options
build_flags = 
    -DUSE_HAL_DRIVER
    -DSTM32F103xB
    -DUSE_FREERTOS
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DDEVICE_MODEL=\"EVSE-STM32F103\"
    -DDEVICE_VENDOR=\"PhuthuyCoding\"
    -I../shared
    -Os
    -Wall
    -Wextra
    -Werror
    -fdata-sections
    -ffunction-sections
    -fstack-usage

; Memory optimization
build_unflags = -Os
build_flags = -Os -flto

; Libraries
lib_deps = 
    stm32duino/STM32duino FreeRTOS@^10.3.1

; Upload settings
upload_protocol = stlink
upload_flags = -c set CPUTAPID 0x1ba01477

; Monitor settings
monitor_speed = 115200
monitor_filters = 
    default
    time

; Debug settings
debug_tool = stlink
debug_init_break = tbreak main
debug_build_flags = -O0 -g3 -ggdb

; Custom targets
extra_scripts = 
    pre:../tools/version_gen.py
    post:../tools/memory_check.py

; Check memory usage
check_tool = cppcheck
check_flags = 
    --enable=all
    --std=c11
    --platform=unix32
