[env:esp07s]
platform = espressif8266
board = esp07s
framework = arduino

; Build options
build_flags =
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DDEVICE_MODEL=\"SolEVC-CPC\"
    -DDEVICE_VENDOR=\"SolEVC\"
    -I../shared
    -DMQTT_MAX_PACKET_SIZE=1024
    -DWIFI_RECONNECT_INTERVAL=30000
    -DOTA_UPDATE_ENABLED
    -Os
    -DPIO_FRAMEWORK_ARDUINO_LWIP2_LOW_MEMORY
    -DVTABLES_IN_FLASH
    -fexceptions

; Libraries
lib_deps = 
    bblanchon/ArduinoJson@^6.21.2
    knolleary/PubSubClient@^2.8
    tzapu/WiFiManager@^2.0.16-rc.2
    arduino-libraries/NTPClient@^3.2.1
    me-no-dev/ESPAsyncWebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1

; Upload settings
upload_speed = 460800
upload_resetmethod = nodemcu

; Monitor settings
monitor_speed = 115200
monitor_filters = 
    esp8266_exception_decoder
    time

; OTA settings
upload_protocol = espota
upload_port = evse-device.local

; Filesystem
board_build.filesystem = littlefs
board_build.ldscript = eagle.flash.4m2m.ld

; Custom targets
extra_scripts =
    pre:../tools/web_build.py
    post:../tools/upload_check.py

; ============================================
; Testing Environment (Native - runs on PC)
; ============================================
[env:native]
platform = native
test_framework = unity
test_build_src = yes
build_flags =
    -std=c++11
    -DUNIT_TEST
    -I../shared
    -Itest/test_mocks
lib_deps =
    bblanchon/ArduinoJson@^6.21.2

; ============================================
; Testing Environment (Embedded - runs on ESP8266)
; ============================================
[env:test_esp]
platform = espressif8266
board = esp07s
framework = arduino
test_framework = unity
test_build_src = yes
build_flags =
    -DUNIT_TEST
    -I../shared
    -Itest/test_mocks
    -DMQTT_MAX_PACKET_SIZE=1024
lib_deps =
    bblanchon/ArduinoJson@^6.21.2
    knolleary/PubSubClient@^2.8
    arduino-libraries/NTPClient@^3.2.1
monitor_speed = 115200
